<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi' xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Fragment>
  <ComponentGroup Id="Service_MCO">
      <ComponentRef Id="Service_MCO_svc" />
    </ComponentGroup>

    <DirectoryRef Id="MCOBINDIR">
      <Component Id='Service_MCO_svc'
                 Guid="7601FCEA-90B3-CC69-6A69-4087FBC7292D"
                 Win64="<%= settings[:win64] %>">
        <File Id="RubyWExe"
              KeyPath="yes"
              Source="SourceDir\<%= settings[:base_dir] %>\<%= settings[:company_id] %>\<%= settings[:product_id] %>\puppet\bin\rubyw.exe" />
        <!-- This service is installed with start set to demand because
        it won't be correctly configured to start right away. The
        puppet run that configures mcollective will allow it to start
        and set it to automatic -->
        <ServiceInstall Id="MCOServiceInstaller"
          Account="[PUPPET_AGENT_ACCOUNT_DOMAIN]\[PUPPET_AGENT_ACCOUNT_USER]"
          Password="[PUPPET_AGENT_ACCOUNT_PASSWORD]"
          Description="Puppet Labs server orchestration framework"
          DisplayName="Marionette Collective Server"
          Interactive="no"
          Name="mcollective"
          Start="demand"
          Type="ownProcess"
          ErrorControl="normal"
          Vital="yes"
          Arguments="-I&quot;[INSTALLDIR]puppet\lib&quot; -rubygems &quot;[INSTALLDIR]puppet\bin\mcollectived&quot; --daemonize"
          />
        <ServiceControl Id="MCOStartService"
                        Stop="both"
                        Remove="uninstall"
                        Name="mcollective"
                        Wait="yes" />
      </Component>
    </DirectoryRef>
  </Fragment>
</Wix>
